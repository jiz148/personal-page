{% load crispy_forms_tags %}

<p>
<form id="article-form" method="post" action="{% url 'blog:article_create' %}" enctype='multipart/form-data'>
  {% csrf_token %}
  {{ form|crispy }}
  <input type = "submit" value="Submit" id="article-submit">
  <input type="submit" value="Cancel" onclick="$ajax.generateContent('{% url "blog:base" %}', '#main-content')"; return false;">
</form>
</p>
<script type="text/javascript">
  $(document).ready(function(){

    $("#article-form").submit(function (event) {

      // prevent the default event of forms
      event.preventDefault();

      let formData = new FormData();
      console.log($(this)[0])
      $(this).serializeArray().forEach(function (item) {
        formData.append(item.name, item.value);
      });

      formData.append('picture', $('#id_{{ form.upload_field_name }}')[0].files[0]);

      $.ajax({
        data: formData,
        type: $(this).attr('method'),
        url: $(this).attr('action'),
        processData: false,
        contentType: false,
        cache: false,
        success: function (res) {
          console.log(res);
          $ajax.generateContent(res['success_url'], "#blog-content");
        }
      })
    });
  });
</script>
{% comment %}
<script>
  $("#upload_").submit(function () {
    console.log('Checking file size');
    if (window.File && window.FileReader && window.FileList && window.Blob) {
      var file = $('#id_{{ form.upload_field_name }}')[0].files[0];
      if (file && file.size > {{ form.max_upload_size }}) {
        alert("File " + file.name + " of type " + file.type + " must be < {{ form.max_upload_limit_text }}");
        return false;
      }
    }
  })
</script>
{% endcomment %}
